This repository store supplementary materials for a paper, "Muscle Activation Analysis from Gait Kinematics and Reinforcement Learning".

## Videos
* [U-turning](https://youtu.be/ZZZOeoNIZNo)
<img src="https://github.com/koonyook/muscle-from-kinematic/blob/master/output/video/U-turning.gif" width="400">

* [Normal walking](https://youtu.be/MpSMT-Yjdwo)
<img src="https://github.com/koonyook/muscle-from-kinematic/blob/master/output/video/Walking.gif" width="600">

## Dependency installation
All the walkthrough here are tested on Ubuntu 18.04.

### Install TinyXML, Eigen, OpenGL, assimp, Python3, etc...

```bash
sudo apt-get install libtinyxml-dev libeigen3-dev libxi-dev libxmu-dev freeglut3-dev libassimp-dev libpython3-dev python3-tk python3-numpy virtualenv ipython3 cmake-curses-gui
```

### Install boost with python3 (1.66)

We strongly recommand that you install boost libraries from the **source code**
(not apt-get, etc...).

- Download boost sources with the version over 1.66.(https://www.boost.org/users/history/version_1_66_0.html)

- Compile and Install the sources

```bash
cd /path/to/boost_1_xx/
./bootstrap.sh --with-python=python3
sudo ./b2 --with-python --with-filesystem --with-system --with-regex install
```

- Check yourself that the libraries are installed well in your directory `/usr/local/`. (or `/usr/`)

If installed successfully, you should have something like

Include

* `/usr/local/include/boost/`
* `/usr/local/include/boost/python/`
* `/usr/local/include/boost/python/numpy`

Lib 

* `/usr/local/lib/libboost_filesystem.so`
* `/usr/local/lib/libboost_python3.so`
* `/usr/local/lib/libboost_numpy3.so`

### install DART 6.X
```bash
apt-add-repository ppa:dartsim/ppa
apt-get install libdart6-all-dev
```

### Install Pytorch, numpy, matplotlib with PIP

You should first activate virtualenv.
```bash
virtualenv /path/to/venv --python=python3
source /path/to/venv/bin/activate
```
Then, install.
```bash
pip3 install torch torchvision
pip3 install numpy matplotlib ipython
```

## How to compile and run

```bash
cd learning
mkdir build
cd build
cmake .. 
make -j8
```

- Run Training
```bash
source /path/to/virtualenv/activate
cd learning/python
python3 main.py -d ../dataFAT/metadata_walking.txt
```

All the training networks are saved in training/nn folder. The training can be continued by
```bash
python3 main.py -d ../dataFAT/metadata_walking.txt -m current
```

- Render 3D visualization of the learning in GUI.
```bash
source /path/to/virtualenv/activate
cd learning/build
./render/render ../dataFAT/metadata_walking.txt ../nn/xxx.pt ../nn/xxx_muscle.pt
```
In GUI, you can press 'o' to show the bone alignement.

- Export muscle activation
```bash
source /path/to/virtualenv/activate
cd learning/build
./actExport/actExport ../dataFAT/metadata_walking.txt ../nn/xxx.pt ../nn/xxx_muscle.pt
```

- Metadata file
The metadata file is used to tell the program where is the motion capture file, skeleton, and muscle details.
All these resources can be generated by source code in data_preporcessing directory by running 01, 02, 04, and 05 python script in order.